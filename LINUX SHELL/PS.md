#  Команда: ps
---
### Общее и Параметры
**ps** (process status) — программа в UNIX-системах, выводящая отчёт о работающих процессах.

По умолчанию выводит процессы текущего пользователя в текущем терминале.
Синтаксис команды ps очень просто: ps -[опция]. Однако опций у ps просто море, чтобы разобраться в них, мы разбили их на 2 группы:

- Опции выбора процессов для отображения;
- Опции работы с форматом вывода данных на экран.

Начнем с опций команды ps, помогающих выбрать нужные процессы для отображения их состояний. Вот список опций выбора процессов для отображения:

- -A, -e, (a) - выбрать все процессы;
- -a - выбрать все процессы, кроме фоновых;
- -d, (g) - выбрать все процессы, даже фоновые, кроме процессов сессий;
- -N - выбрать все процессы кроме указанных;
- -С - выбирать процессы по имени команды;
- -G - выбрать процессы по ID группы;
- -p, (p) - выбрать процессы PID;
- --ppid - выбрать процессы по PID родительского процесса;
- -s - выбрать процессы по ID сессии;
- -t, (t) - выбрать процессы по tty;
- -u, (U) - выбрать процессы пользователя.
---
### Осноные
Чтобы просмотреть все запущенные процессы, используйте одну из следующих команд:
```shell
ps -e
или
ps -A
```
Чтобы показать все процессы, кроме лидеров сессии, выполните:
```shell
ps -d
```
Вы можете инвертировать вывод с помощью переключателя -N. Например, если вы хотите вывести только лидеров сеансов, выполните следующую команду:
```shell
ps -d -N
```
Если вы хотите увидеть только процессы, связанные с этим терминалом, выполните:
```shell
ps T
```
Если вы хотите просмотреть все работающие (running) процессы, используя следующую команду:

```shell
ps r
```
### Выбор конкретных процессов
Например, если вы знаете идентификатор процесса PID, вы можете просто использовать следующую команду:
```shell
ps -p <PID>
```
Вы можете выбрать несколько процессов, указав несколько идентификаторов процесса следующим образом:

```shell
ps -p "<pid1> <pid2>"
or
ps -p <pid1>,<pid2>
```

Скорее всего, вы не будете знать идентификатор процесса, и его легче искать по команде. Для этого используйте следующую команду:
```shell
ps -C <команда>
Пример:
ps -C nginx
```

Если вы хотите найти все процессы, выполняемые конкретным пользователем, выполните следующую команду, указав имя пользователя:
```shell
ps -U <username>
Пример:
ps -U ruslan
```

### Сохранить список процессов в текстовый файл

```shell
ps aux > output_file.txt
```

### Дерево процессов pstree
```shell
-a, --arguments     показывать аргументы командной строки
  -A, --ascii         использовать ASCII-символы для рисования линий
  -c, --compact-not   не сжимать одинаковые поддеревья
  -C, --color=ТИП     раскрашивать процессы по атрибуту
                      (возраст)
  -g, --show-pgids    показывать идентификаторы групп процесса;
                      включает -c
  -G, --vt100         использовать символы рисования линий от VT100
  -h, --highlight-all подсветить текущий процесс и его предков
  -H PID,
  --highlight-pid=PID подсветить процесс PID и его предков
  -l, --long          не обрезать длинные строки
  -n, --numeric-sort  сортировать вывод по PID
  -N тип,
  --ns-sort=тип       сортировать по типу пространства имён
                      (cgroup, ipc, mnt, net, pid, time, user, uts)
  -p, --show-pids     показывать идентификаторы процессов (PID); включает -c
  -s, --show-parents  показывать родителей выбранного процесса
  -S, --ns-changes    показывать переходы пространств имён
  -t, --thread-names  показывать полные имена нитей
  -T, --hide-threads  скрывать нити, показывать только процессы
  -u, --uid-changes   показывать переходы идентификаторов пользователей
  -U, --unicode       использовать символы рисования линий UTF-8 (Юникод)
  -V, --version       показать информацию о версии
  -Z, --security-context
                      показывать атрибуты безопасности

  PID                 начинать от указанного PID; по умолчанию 1 (init)
  ПОЛЬЗОВАТЕЛЬ        показать только дерево процессов указанного пользовател
```

```shell
pstree -snAh
```

Вывод: 
```shell
systemd-+-systemd-journal
        |-systemd-udevd
        |-systemd-resolve
        |-systemd-timesyn---{systemd-timesyn}
        |-accounts-daemon---3*[{accounts-daemon}]
        |-avahi-daemon---avahi-daemon
        |-bluetoothd
        |-cron
        |-dbus-daemon
        ...
```

По конкретному процессу 
```shell
pstree -p <PID>
```

---

## Оценка интенсивности использования памяти с помощью команды ps

Команда ps позволяет получить информацию об использовании оперативной памяти для отдельного процесса.

Команда ps **v** _id-процесса_ создает отчет с подробной информацией об использовании памяти указанным процессом. Этот отчет содержит:

- Число страничных ошибок
- Общий объем страниц из рабочего сегмента памяти, к которым обращался процесс
- Объем рабочего сегмента памяти и сегмента, содержащего двоичный код программы
- Размер сегмента, содержащего исходный текст программы
- Размер постоянной области памяти
- Долю оперативной памяти, занятую данным процессом (в процентах)

Пример приведен ниже:

```plaintext-ibm
# ps v
   PID    TTY STAT  TIME PGIN  SIZE   RSS   LIM  TSIZ   TRS %CPU %MEM COMMAND
 36626  pts/3 A     0:00    0   316   408 32768    51    60  0.0  0.0 ps v
```

Ниже описаны те поля отчета команды ps, на которые стоит обратить внимание:

PGIN

Число операций чтения страниц, вызванных страничными ошибками. Поскольку все операции ввода-вывода связаны со страничными ошибками, данный параметр является основной характеристикой интенсивности ввода-вывода.

SIZE

Размер области данных процесса в пространстве подкачки в КБ (при вызове команды с другими флагами это значение указывается в поле SZ). Это число равно числу страниц рабочего сегмента процесса, которые были затронуты четыре раза. Если некоторые страницы рабочего сегмента в настоящее время выгружаются, это число больше, чем объем используемой реальной памяти. Значение SIZE учитывает страницы из сегмента процесса и из сегмента данных общих библиотек, используемых процессом.

RSS

Объем физической памяти, занятой процессом, в килобайтах. Это число равно сумме количества страниц рабочего сегмента и кодового сегмента в памяти, умноженной на 4. Помните, что страницы сегментов кода используются совместно всеми выполняющимися в данный момент экземплярами программы. Если запущено 26 процессов ksh, в оперативной памяти будет находиться только одна копия страниц с исполняемым кодом ksh, однако в выводе команды ps размер этих страниц будет прибавлен к значению RSS всех экземпляров программы ksh.

TSIZ

Размер текста (общего для всех экземпляров программы). Эта величина представляет собой размер текстовой части исполняемого файла программы. Страницы с текстовой частью исполняемой программы загружаются в память только при обращении к этим страницам. Данная величина представляет собой возможный верхний предел количества загруженного текста. Значение TSIZ не отражает фактического объема занятой памяти. Значение TSIZ можно узнать и с помощью команды dump **-ov**, указав в качестве параметра исполняемый файл (например, dump **-ov** /usr/bin/ls).

TRS

Размер резидентной (размещенной в реальной памяти) командной части программы. Это число страниц сегмента кода, умноженное на 4. Это число преувеличивает использование памяти для программ, у которых запущено несколько экземпляров. Значение TRS может превосходить значение TSIZ за счет того, что сегмент с кодом программы содержит не только текст программы, но и заголовок XCOFF, а также описание загружаемых библиотек.

%MEM

Это значение указывает, какую долю (в процентах) от общего объема оперативной памяти компьютера составляет значение RSS. Это значение должно характеризовать долю физической памяти, занятой процессом. К сожалению, как и RSS, эта величина переоценивает загрузку памяти процессами, которые совместно используют командную часть программы. Кроме того, округление до ближайшего целого значения приводит к тому, что значение %MEM будет равно 0,0, если отношение RSS к объему оперативной памяти меньше 0,005.

---


### Примеры
Получает все процессы формат (размер, PID, пользователь) и сортирует по кол-ву потребляемой памяти с реверсом (от большего к меньшему)
```shell
ps -A -o size,pid,user | sort -rn -k1
```

---

## Команда: wc он же"туалет" Word Count (Счетчик слов)

Используется только для одного файла или для разбора стандартного ввода через конвейер, wc также может подсчитывать и суммировать несколько файлов одновременно. Три основных флага wc — это -w (подсчет слов), -c (подсчет символов) и -l (подсчет строк).

```shell
wc -l /etc/hosts*
Результат:
  9 /etc/hosts
  10 /etc/hosts.allow
  17 /etc/hosts.deny
  36 итого
```