# Основные
## Команды для БД
| N   | Команда | Описание                                                                   |
| --- | ------- | -------------------------------------------------------------------------- |
| 1   | CREATE  | Создает новую таблицу, представление таблицы или другой объект в БД        |
| 2   | ALTER   | Модифицирует существующий в БД объект, такой как таблица                   |
| 3   | DROP    | Удаляет существующую таблицу, представление таблицы или другой объект в БД |
### Создание базы данных

```python
"""CREATE DATABASE IF NOT EXISTS <dbname>;"""
```

### Удаление БД
```python
"""DROP IF EXISTS <dbname>;"""
```

### Выбор БД
```python
"""USE <dbname>;"""
```
## Команды для таблиц
| N   | Команда | Описание                                        |
| --- | ------- | ----------------------------------------------- |
| 1   | SELECT  | Извлекает записи из одной или нескольких таблиц |
| 2   | INSERT  | Создает записи                                  |
| 3   | UPDATE  | Модифицирует записи                             |
| 4   | DELETE  | Удаляет записи                                  |

### Создание таблицы
```python
"""
CREATE TABLE IF NOT EXISTS <tbname> (
		id INTEGER PRIMARY KEY AUTOINCREMENT, 
		name VARCHAR(50),
		age VARCHAR(50)							 
)
"""
```

# Данные

## Типы данных
### Точные числовые
|Тип данных|От|До|
|---|---|---|
|bigint|-9,223,372,036,854,775,808|9,223,372,036,854,775,807|
|int|-2,147,483,648|2,147,483,647|
|smallint|-32,768|32,767|
|tinyint|0|255|
|bit|0|1|
|decimal|-10^38 +1|10^38 -1|
|numeric|-10^38 +1|10^38 -1|
|money|-922,337,203,685,477.5808|+922,337,203,685,477.5807|
|smallmoney|-214,748.3648|+214,748.3647|
### Приблизительные числовые
| Тип данных | От           | До          |
| ---------- | ------------ | ----------- |
| float      | -1.79E + 308 | 1.79E + 308 |
| real       | -3.40E + 38  | 3.40E + 38  |
### Дата и время
|Тип данных|От|До|
|---|---|---|
|datetime|Jan 1, 1753|Dec 31, 9999|
|smalldatetime|Jan 1, 1900|Jun 6, 2079|
|date|Дата сохраняется в виде June 30, 1991|
|time|Время сохраняется в виде 12:30 P.M.|
### Строковые символьные
| N   | Тип данных | Описание                                                                 |
| --- | ---------- | ------------------------------------------------------------------------ |
| 1   | char       | Строка длиной до 8,000 символов (не-юникод символы, фиксированной длины) |
| 2   | varchar    | Строка длиной до 8,000 символов (не-юникод символы, переменной длины)    |
| 3   | text       | Не-юникод данные переменной длины, длиной до 2,147,483,647 символов      |
### Строковые символьные (юникод)
|N|Тип данных|Описание|
|---|---|---|
|1|nchar|Строка длиной до 4,000 символов (юникод символы, фиксированной длины)|
|2|nvarchar|Строка длиной до 4,000 символов (юникод символы, переменной длины)|
|3|ntext|Юникод данные переменной длины, длиной до 1,073,741,823 символов|
### Бинарные
|N|Тип данных|Описание|
|---|---|---|
|1|binary|Данные размером до 8,000 байт (фиксированной длины)|
|2|varbinary|Данные размером до 8,000 байт (переменной длины)|
|3|image|Данные размером до 2,147,483,647 байт (переменной длины)|
### Смешанные
|N|Тип данных|Описание|
|---|---|---|
|1|timestamp|Уникальные числа, обновляющиеся при каждом изменении строки|
|2|uniqueidentifier|Глобально-уникальный идентификатор (GUID)|
|3|cursor|Объект курсора|
|4|table|Промежуточный результат, предназначенный для дальнейшей обработки|

## Операторы
Оператор (operators) — это ключевое слово или символ, которые, в основном, используются в инструкциях `WHERE` для выполнения каких-либо операций. Они используются как для определения условий, так и для объединения нескольких условий в инструкции.

В дальнейших примерах мы будем исходить из предположения, что переменная `a` имеет значение `10`, а `b` — `20`.

### Арифметические
| Оператор                         | Описание                                                            | Пример      |
| -------------------------------- | ------------------------------------------------------------------- | ----------- |
| + (сложение)                     | Сложение значений                                                   | a + b = 30  |
| — (вычитание)                    | Вычитание правого операнда из левого                                | b — a = 10  |
| * (умножение)                    | Умножение значений                                                  | a * b = 200 |
| / (деление)                      | Деление левого операнда на правый                                   | b / a = 2   |
| % (деление с остатком/по модулю) | Деление левого операнда на правый с остатком (возвращается остаток) | b % a = 0   |

### Операторы сравнения
| Оператор | Описание                                                             | Пример          |
| -------- | -------------------------------------------------------------------- | --------------- |
| =        | Определяет равенство значений                                        | a = b -> false  |
| !=       | Определяет НЕравенство значений                                      | a != b -> true  |
| <>       | Определяет НЕравенство значений                                      | a <> b -> true  |
| >        | Значение левого операнда больше значения правого операнда?           | a > b -> false  |
| <        | Значение левого операнда меньше значения правого операнда?           | a < b -> true   |
| >=       | Значение левого операнда больше или равно значению правого операнда? | a >= b -> false |
| <=       | Значение левого операнда меньше или равно значению правого операнда? | a <= b -> true  |
| !<       | Значение левого операнда НЕ меньше значения правого операнда?        | a !< b -> false |
| !>       | Значение левого операнда НЕ больше значения правого операнда?        | a !> b -> true  |

### Логические операторы
| N   | Оператор | Описание                                                                                                        |
| --- | -------- | --------------------------------------------------------------------------------------------------------------- |
| 1   | ALL      | Сравнивает все значения                                                                                         |
| 2   | AND      | Объединяет условия (все условия должны совпадать)                                                               |
| 3   | ANY      | Сравнивает одно значение с другим, если последнее совпадает с условием                                          |
| 4   | BETWEEN  | Проверяет вхождение значения в диапазон от минимального до максимального                                        |
| 5   | EXISTS   | Определяет наличие строки, соответствующей определенному критерию                                               |
| 6   | IN       | Выполняет поиск значения в списке значений                                                                      |
| 7   | LIKE     | Сравнивает значение с похожими с помощью операторов подстановки                                                 |
| 8   | NOT      | Инвертирует (меняет на противоположное) смысл других логических операторов, например, NOT EXISTS, NOT IN и т.д. |
| 9   | OR       | Комбинирует условия (одно из условий должно совпадать)                                                          |
| 10  | IS NULL  | Определяет, является ли значение нулевым                                                                        |
| 11  | UNIQUE   | Определяет уникальность строки                                                                                  |

## COUNT
Функция `COUNT()`представляет собой [агрегатную функцию](https://www.sqlitetutorial.net/sqlite-aggregate-functions/) , которая возвращает количество элементов в группе.

Например, вы можете использовать `COUNT()`функцию для получения количества треков из `tracks`таблицы, количества исполнителей из `artists`таблицы и т. д.

Функция `COUNT`ведет себя в соответствии с переданными ей аргументами и указанной вами `ALL`опцией .`DISTINCT`

Ниже описываются значения `ALL`и `DISTINCT`параметры:

- `ALL`: если указать all, `COUNT()`функция подсчитает все ненулевые значения, включая дубликаты. Функция `COUNT()`использует `ALL`опцию по умолчанию, если вы ее пропустите.
- `DISTINCT`: если вы явно используете эту `DISTINCT`опцию, `COUNT`функция учитывает только уникальные и ненулевые значения.

Выражение может быть столбцом или выражением, включающим столбцы, к которым `COUNT()`применяется функция.

## DISTINCT
Чтобы получить уникальные записи в sqlite можно использовать команду SELECT DISTINCT
	SELECT DISTINCT column_name(s) FROM table_name
```python
SELECT DISTINCT major FROM students
or
SELECT DISTINCT major, year FROM students
```
Также можно использовать COUNT, чтобы вернуть кол-во уникальных значений в столбце или комбинации столбцов
```python
SELECT COUNT(DISTINCT (id)) FROM table_name
```

##  INTERSECT
### Введение в оператор INTERSECT SQLite

Оператор SQLite `INTERSECT`позволяет объединять наборы результатов двух [запросов](https://www.sqlitetutorial.net/sqlite-select/) и возвращает отдельные строки, которые появляются в обоих наборах результатов запросов.

Ниже показан синтаксис оператора `INTERSECT`:
```sql
SELECT select_list1 FROM table1 INTERSECT SELECT select_list2 FROM table2;
```
Основные правила объединения наборов результатов двух запросов следующие:

- Во-первых, количество и порядок столбцов во всех запросах должны быть одинаковыми.
- Во-вторых, типы данных должны быть сопоставимыми.

## JOIN
https://timeweb.com/ru/community/articles/kak-rabotaet-sql-join
SQL Join – одна из наиболее часто используемых команд в SQL-синтаксисе. Она используется для поиска информации в базах данных по заранее определенным критериям. В частности, Join отвечает за объединение нескольких групп данных в единый поток информации.

### INNER JOIN

Этот режим объединения результатов поиска в базах данных SQL включается автоматически. Если вы не укажете намеренно тип Join, то сработает именно Inner Join. С помощью него можно указать сразу два критерия (две таблицы) и по ним отсеять контент.
![[Pasted image 20250219195604.png]]
```sql
SELECT *
FROM table-1
JOIN table-2 ON table-1.parameter=table-2.parameter
```
Получение данных, относящихся как к левой, так и к правой таблице:
```sql
SELECT поля_таблиц
FROM левая_таблица INNER JOIN правая_таблица
    ON правая_таблица.ключ = левая_таблица.ключ
```

### OUTER JOIN
#### LEFT JOIN
Получение всех данных из левой таблицы, соединённых с соответствующими данными из правой:
![[Pasted image 20250219195620.png]]
```sql
SELECT поля_таблиц 
FROM левая_таблица LEFT JOIN правая_таблица 
    ON правая_таблица.ключ = левая_таблица.ключ 
```

Получение данных, относящихся только к левой таблице:
![[Pasted image 20250219195638.png]]
```sql
SELECT поля_таблиц
FROM левая_таблица LEFT JOIN правая_таблица
    ON правая_таблица.ключ = левая_таблица.ключ
WHERE правая_таблица.ключ IS NULL
```

#### RIGHT JOIN
Получение всех данных из правой таблицы, соединённых с соответствующими данными из левой:
![[Pasted image 20250219195629.png]]
```sql
SELECT поля_таблиц
FROM левая_таблица RIGHT JOIN правая_таблица
    ON правая_таблица.ключ = левая_таблица.ключ
```

Получение данных, относящихся только к правой таблице:
![[Pasted image 20250219195656.png]]
```sql
SELECT поля_таблиц
FROM левая_таблица RIGHT JOIN правая_таблица
    ON правая_таблица.ключ = левая_таблица.ключ
WHERE левая_таблица.ключ IS NULL
```

#### FULL OUTER JOIN
Получение всех данных, относящихся к левой и правой таблицам, а также их внутреннему соединению:
![[Pasted image 20250219195522.png]]
```sql
SELECT поля_таблиц 
FROM левая_таблица
    FULL OUTER JOIN правая_таблица
    ON правая_таблица.ключ = левая_таблица.ключ
```

#### FULL OUTER JOIN (обратное)
Получение данных, не относящихся к левой и правой таблицам одновременно (обратное INNER JOIN):
![[Pasted image 20250219195509.png]]
```sql
SELECT поля_таблиц 
FROM левая_таблица
    FULL OUTER JOIN правая_таблица
    ON правая_таблица.ключ = левая_таблица.ключ
WHERE левая_таблица.ключ IS NULL
    OR правая_таблица.ключ IS NULL
```

![[Pasted image 20250219170944.png]]

## AVG
**Вычисляет среднее арифметическое набора значений, содержащихся в определенном поле запроса**.

```sql
SELECT AVG(salary) FROM salaries;
or 
SELECT SUM(salary) / COUNT(salary) FROM salaries;
```

## SQLite CAST и CONVERT
Когда мы выполняем операции со значениями с разными типами данных, СУБД пытается выполнить преобразование и привести используемые значения к нужному типу. Например, в примере ниже мы сравниваем значения с типами STRING и INT. Чтобы выполнить это сравнение MySQL автоматически с конвертирует строковое значение в числовое.

Но не все преобразования СУБД может сделать автоматически, и тогда необходимо делать явное преобразование типов. Для этого в MySQL есть две очень схожие функции CAST и CONVERT
```sql
CAST(значение AS тип_для_конвертации);
CONVERT(значение, тип_для_конвертации);
```

Пример:
```sql
SELECT CAST(12005.6 AS DECIMAL), CONVERT(12005.4, DECIMAL);
```

|Тип|Описание|
|:--|:--|
|DATE|Конвертирует значение в DATE. Формат: "YYYY-MM-DD".|
|DATETIME|Конвертирует значение в DATETIME. Формат: "YYYY-MM-DD hh:mm:ss".|
|TIME|Конвертирует значение в TIME. Формат: "hh:mm:ss".|
|DECIMAL[(M[,D])]|Конвертирует значение в DECIMAL. Имеет два необязательных аргумента M и D, определяющих максимальное количество знаков до и после запятой соответственно. По умолчанию, D равен 0, а M равен 10.|
|CHAR[(N)]|Конвертирует значение в CHAR. В качестве необязательного аргумента можно передать максимальную длину строки.|
|SIGNED|Конвертирует значение в значение BIGINT.|
|UNSIGNED|Конвертирует значение в беззнаковое значение BIGINT.|
|BINARY|Конвертирует значение в BINARY.|
|YEAR|Конвертирует значение в год.|

## UNION
Результаты выполнения SQL запросов можно объединять. Для этого существует оператор UNION.

```sql
SELECT поля_таблиц FROM список_таблиц ...
UNION [ALL]
SELECT поля_таблиц FROM список_таблиц ... ;
```

UNION по умолчанию убирает повторения в результирующей таблице. Для отображения с повторением есть необязательный параметр ALL.

- Не путайте операции объединения запросов с операциями объединения таблиц. Для этого служит оператор JOIN.
- Не путайте операции объединения запросов с подзапросами. Подзапросы выполняются для связанных таблиц.

Объединение таблиц оператором UNION выполняется для таблиц никак не связанных, но со схожей структурой.

Для корректной работы UNION нужно, чтобы результирующие таблицы каждого из SQL запросов имели одинаковое число столбцов, с одним и тем же типом данных и в той же самой последовательности.

Существует два других оператора, чьё поведение крайне схоже с UNION:

- INTERSECT Комбинирует два запроса SELECT, но возвращает записи только первого SELECT, которые имеют совпадения во втором элементе SELECT.

- EXCEPT Комбинирует два запроса SELECT, но возвращает записи только первого SELECT, которые не имеют совпадения во втором элементе SELECT.

```sql
SELECT first_name, middle_name, last_name FROM Student_table
UNION
SELECT first_name, middle_name, last_name FROM Teacher_table
```

## ORDER BY
При выполнении SELECT запроса, строки по умолчанию возвращаются в неопределённом порядке. Фактический порядок строк в этом случае зависит от плана соединения и сканирования, а также от порядка расположения данных на диске, поэтому полагаться на него нельзя. Для упорядочивания записей используется конструкция ORDER BY.
```sql
SELECT поля_таблиц FROM наименование_таблицы
WHERE ...
ORDER BY столбец_1 [ASC | DESC][, столбец_n [ASC | DESC]]
```
Где ASC и DESC - направление сортировки:

- ASC - сортировка по возрастанию (по умолчанию)
- DESC - сортировка по убыванию
# Веб-ресурсы

Памятка/шпаргалка по SQL
	https://habr.com/ru/articles/564390/